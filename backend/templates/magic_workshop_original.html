<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Workshop - Codopia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1) rotate(180deg); }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .sparkle { animation: sparkle 2s linear infinite; }
        .float { animation: float 3s ease-in-out infinite; }
        .drag-block {
            cursor: grab;
            transition: all 0.3s ease;
        }
        .drag-block:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .drag-block.dragging {
            cursor: grabbing;
            transform: rotate(5deg) scale(1.1);
            z-index: 1000;
        }
        .drop-zone {
            min-height: 60px;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .drop-zone.drag-over {
            border-color: #8b5cf6;
            background-color: #f3f4f6;
        }
        .code-canvas {
            background: linear-gradient(45deg, #f8fafc 25%, transparent 25%), 
                        linear-gradient(-45deg, #f8fafc 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #f8fafc 75%), 
                        linear-gradient(-45deg, transparent 75%, #f8fafc 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-100 via-pink-50 to-blue-100">
    <!-- Floating Sparkles -->
    <div class="fixed inset-0 pointer-events-none z-10">
        <div class="sparkle absolute top-20 left-10 w-4 h-4 bg-purple-400 rounded-full"></div>
        <div class="sparkle absolute top-40 right-20 w-3 h-3 bg-pink-400 rounded-full" style="animation-delay: 0.5s;"></div>
        <div class="sparkle absolute bottom-40 left-20 w-2 h-2 bg-blue-400 rounded-full" style="animation-delay: 1s;"></div>
        <div class="sparkle absolute bottom-20 right-10 w-3 h-3 bg-yellow-400 rounded-full" style="animation-delay: 1.5s;"></div>
    </div>

    <!-- Navigation -->
    <nav class="bg-white/90 backdrop-blur-md shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <a href="/dashboard" class="flex items-center space-x-2 text-gray-600 hover:text-purple-600">
                        <span>‚Üê</span>
                        <span>Back to Dashboard</span>
                    </a>
                    <div class="h-6 w-px bg-gray-300"></div>
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                            <span class="text-white text-lg">üé®</span>
                        </div>
                        <span class="text-xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">Magic Workshop</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2 bg-purple-100 px-3 py-1 rounded-full">
                        <span class="text-purple-600 font-semibold">{{ child_name }}</span>
                        <span class="text-purple-500">‚Ä¢</span>
                        <span class="text-purple-600">Age {{ child_age }}</span>
                    </div>
                    <button id="sparkle-btn" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-2 rounded-full hover:from-purple-600 hover:to-pink-600 transition-all">
                        ‚ú® Ask Professor Sparkle
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid lg:grid-cols-4 gap-8">
            <!-- Lesson Sidebar -->
            <div class="lg:col-span-1">
                <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-6 sticky top-24">
                    <h2 class="text-2xl font-bold text-purple-700 mb-6">üßô‚Äç‚ôÇÔ∏è Magic Lessons</h2>
                    
                    <div class="space-y-4">
                        <div class="lesson-item bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4 rounded-xl cursor-pointer" data-lesson="1">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="font-bold">Lesson 1: Making the Wizard Move</h3>
                                    <p class="text-sm opacity-90">Learn basic movement spells</p>
                                </div>
                                <span class="text-2xl">üßô‚Äç‚ôÇÔ∏è</span>
                            </div>
                        </div>
                        
                        <div class="lesson-item bg-gray-100 text-gray-600 p-4 rounded-xl cursor-pointer" data-lesson="2">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="font-bold">Lesson 2: Casting Spell Patterns</h3>
                                    <p class="text-sm">Create magical sequences</p>
                                </div>
                                <span class="text-2xl">üîÆ</span>
                            </div>
                        </div>
                        
                        <div class="lesson-item bg-gray-100 text-gray-600 p-4 rounded-xl cursor-pointer" data-lesson="3">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="font-bold">Lesson 3: Magical Decisions</h3>
                                    <p class="text-sm">If-then magic spells</p>
                                </div>
                                <span class="text-2xl">‚ö°</span>
                            </div>
                        </div>
                        
                        <div class="lesson-item bg-gray-100 text-gray-600 p-4 rounded-xl cursor-pointer" data-lesson="4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="font-bold">Lesson 4: Treasure Hunt</h3>
                                    <p class="text-sm">Loops and repetition</p>
                                </div>
                                <span class="text-2xl">üíé</span>
                            </div>
                        </div>
                        
                        <div class="lesson-item bg-gray-100 text-gray-600 p-4 rounded-xl cursor-pointer" data-lesson="5">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="font-bold">Lesson 5: Magic Functions</h3>
                                    <p class="text-sm">Create your own spells</p>
                                </div>
                                <span class="text-2xl">üåü</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-purple-50 rounded-xl">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-purple-700 font-semibold">Progress</span>
                            <span class="text-purple-600">1/5</span>
                        </div>
                        <div class="w-full bg-purple-200 rounded-full h-3">
                            <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-3 rounded-full" style="width: 20%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Learning Area -->
            <div class="lg:col-span-3">
                <div class="grid lg:grid-cols-2 gap-8">
                    <!-- Coding Blocks Palette -->
                    <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-6">
                        <h2 class="text-2xl font-bold text-purple-700 mb-6">üé® Magic Spell Blocks</h2>
                        
                        <div class="space-y-4">
                            <!-- Movement Blocks -->
                            <div class="block-category">
                                <h3 class="text-lg font-semibold text-purple-600 mb-3">Movement Spells</h3>
                                <div class="space-y-2">
                                    <div class="drag-block bg-gradient-to-r from-blue-400 to-blue-500 text-white p-3 rounded-lg flex items-center space-x-3" draggable="true" data-block-type="move">
                                        <span class="text-xl">‚û°Ô∏è</span>
                                        <span class="font-semibold">Move Right</span>
                                    </div>
                                    <div class="drag-block bg-gradient-to-r from-blue-400 to-blue-500 text-white p-3 rounded-lg flex items-center space-x-3" draggable="true" data-block-type="move">
                                        <span class="text-xl">‚¨ÖÔ∏è</span>
                                        <span class="font-semibold">Move Left</span>
                                    </div>
                                    <div class="drag-block bg-gradient-to-r from-blue-400 to-blue-500 text-white p-3 rounded-lg flex items-center space-x-3" draggable="true" data-block-type="move">
                                        <span class="text-xl">‚¨ÜÔ∏è</span>
                                        <span class="font-semibold">Move Up</span>
                                    </div>
                                    <div class="drag-block bg-gradient-to-r from-blue-400 to-blue-500 text-white p-3 rounded-lg flex items-center space-x-3" draggable="true" data-block-type="move">
                                        <span class="text-xl">‚¨áÔ∏è</span>
                                        <span class="font-semibold">Move Down</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Action Blocks -->
                            <div class="block-category">
                                <h3 class="text-lg font-semibold text-purple-600 mb-3">Action Spells</h3>
                                <div class="space-y-2">
                                    <div class="drag-block bg-gradient-to-r from-green-400 to-green-500 text-white p-3 rounded-lg flex items-center space-x-3" draggable="true" data-block-type="action">
                                        <span class="text-xl">‚ú®</span>
                                        <span class="font-semibold">Cast Sparkle</span>
                                    </div>
                                    <div class="drag-block bg-gradient-to-r from-green-400 to-green-500 text-white p-3 rounded-lg flex items-center space-x-3" draggable="true" data-block-type="action">
                                        <span class="text-xl">üîÆ</span>
                                        <span class="font-semibold">Magic Orb</span>
                                    </div>
                                    <div class="drag-block bg-gradient-to-r from-green-400 to-green-500 text-white p-3 rounded-lg flex items-center space-x-3" draggable="true" data-block-type="action">
                                        <span class="text-xl">üåü</span>
                                        <span class="font-semibold">Star Burst</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Control Blocks -->
                            <div class="block-category">
                                <h3 class="text-lg font-semibold text-purple-600 mb-3">Control Spells</h3>
                                <div class="space-y-2">
                                    <div class="drag-block bg-gradient-to-r from-orange-400 to-orange-500 text-white p-3 rounded-lg flex items-center space-x-3" draggable="true" data-block-type="control">
                                        <span class="text-xl">üîÑ</span>
                                        <span class="font-semibold">Repeat 3 times</span>
                                    </div>
                                    <div class="drag-block bg-gradient-to-r from-orange-400 to-orange-500 text-white p-3 rounded-lg flex items-center space-x-3" draggable="true" data-block-type="control">
                                        <span class="text-xl">‚è±Ô∏è</span>
                                        <span class="font-semibold">Wait 1 second</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Code Canvas -->
                    <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-purple-700">üßô‚Äç‚ôÇÔ∏è Spell Canvas</h2>
                            <div class="flex space-x-2">
                                <button id="run-code" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all">
                                    ‚ñ∂Ô∏è Cast Spell
                                </button>
                                <button id="clear-code" class="bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all">
                                    üóëÔ∏è Clear
                                </button>
                            </div>
                        </div>
                        
                        <div id="code-canvas" class="code-canvas min-h-96 p-4 border-2 border-dashed border-purple-300 rounded-xl">
                            <div class="text-center text-purple-400 py-8">
                                <span class="text-4xl block mb-2">üéØ</span>
                                <p class="text-lg">Drag spell blocks here to create your magic!</p>
                                <p class="text-sm mt-2">Start with a movement spell to make the wizard move</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Magic Stage -->
                <div class="mt-8 bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-6">
                    <h2 class="text-2xl font-bold text-purple-700 mb-6">üé≠ Magic Stage</h2>
                    
                    <div id="magic-stage" class="relative bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 rounded-xl h-64 overflow-hidden">
                        <!-- Stars background -->
                        <div class="absolute inset-0">
                            <div class="absolute top-4 left-8 w-1 h-1 bg-white rounded-full sparkle"></div>
                            <div class="absolute top-12 right-12 w-1 h-1 bg-white rounded-full sparkle" style="animation-delay: 0.5s;"></div>
                            <div class="absolute bottom-8 left-16 w-1 h-1 bg-white rounded-full sparkle" style="animation-delay: 1s;"></div>
                            <div class="absolute bottom-16 right-8 w-1 h-1 bg-white rounded-full sparkle" style="animation-delay: 1.5s;"></div>
                        </div>
                        
                        <!-- Wizard Character -->
                        <div id="wizard" class="absolute bottom-4 left-4 text-4xl transition-all duration-500 float">
                            üßô‚Äç‚ôÇÔ∏è
                        </div>
                        
                        <!-- Magic Effects Container -->
                        <div id="magic-effects" class="absolute inset-0 pointer-events-none"></div>
                        
                        <!-- Stage Controls -->
                        <div class="absolute top-4 right-4 flex space-x-2">
                            <button id="reset-stage" class="bg-white/20 backdrop-blur-sm text-white px-3 py-1 rounded-lg text-sm hover:bg-white/30 transition-all">
                                üîÑ Reset
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-4 flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-2">
                                <span class="text-purple-600">‚≠ê</span>
                                <span class="text-purple-700 font-semibold">Magic Points: <span id="magic-points">0</span></span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-pink-600">üèÜ</span>
                                <span class="text-pink-700 font-semibold">Achievements: <span id="achievements">0</span></span>
                            </div>
                        </div>
                        <div class="text-sm text-gray-600">
                            Complete the lesson to unlock the next magical adventure!
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Professor Sparkle Modal -->
    <div id="sparkle-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-2xl">
            <div class="flex items-center space-x-4 mb-6">
                <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                    <span class="text-white text-2xl">‚ú®</span>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-purple-700">Professor Sparkle</h2>
                    <p class="text-purple-600">Your Magical Coding Tutor</p>
                </div>
                <button id="close-sparkle" class="ml-auto text-gray-400 hover:text-gray-600">
                    <span class="text-2xl">√ó</span>
                </button>
            </div>
            
            <div id="sparkle-chat" class="bg-purple-50 rounded-xl p-4 h-64 overflow-y-auto mb-4">
                <div class="sparkle-message bg-white rounded-lg p-3 mb-3">
                    <p class="text-purple-700">‚ú® Hello there, young wizard! I'm Professor Sparkle, and I'm here to help you learn the magical art of coding! What would you like to know about today's lesson?</p>
                </div>
            </div>
            
            <div class="flex space-x-2">
                <input id="sparkle-input" type="text" placeholder="Ask Professor Sparkle anything..." class="flex-1 px-4 py-2 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                <button id="send-sparkle" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-2 rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all">
                    Send ‚ú®
                </button>
            </div>
            
            <div class="mt-4 flex justify-center">
                <button id="voice-sparkle" class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-2 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all">
                    üé§ Talk to Professor Sparkle
                </button>
            </div>
        </div>
    </div>

    <script>
        // Drag and Drop Functionality
        let draggedElement = null;
        let codeBlocks = [];
        
        // Initialize drag and drop
        document.addEventListener('DOMContentLoaded', function() {
            initializeDragAndDrop();
            initializeProfessorSparkle();
            initializeMagicStage();
        });
        
        function initializeDragAndDrop() {
            const dragBlocks = document.querySelectorAll('.drag-block');
            const codeCanvas = document.getElementById('code-canvas');
            
            dragBlocks.forEach(block => {
                block.addEventListener('dragstart', handleDragStart);
                block.addEventListener('dragend', handleDragEnd);
            });
            
            codeCanvas.addEventListener('dragover', handleDragOver);
            codeCanvas.addEventListener('drop', handleDrop);
        }
        
        function handleDragStart(e) {
            draggedElement = e.target.cloneNode(true);
            e.target.classList.add('dragging');
        }
        
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            if (draggedElement) {
                const canvas = document.getElementById('code-canvas');
                
                // Clear placeholder text if this is the first block
                if (codeBlocks.length === 0) {
                    canvas.innerHTML = '';
                }
                
                // Create a container for the dropped block
                const blockContainer = document.createElement('div');
                blockContainer.className = 'mb-2 relative group';
                
                // Add the block
                draggedElement.classList.remove('dragging');
                draggedElement.classList.add('mb-0');
                draggedElement.draggable = false;
                
                // Add delete button
                const deleteBtn = document.createElement('button');
                deleteBtn.innerHTML = '√ó';
                deleteBtn.className = 'absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 text-sm opacity-0 group-hover:opacity-100 transition-opacity';
                deleteBtn.onclick = () => {
                    blockContainer.remove();
                    updateCodeBlocks();
                };
                
                blockContainer.appendChild(draggedElement);
                blockContainer.appendChild(deleteBtn);
                canvas.appendChild(blockContainer);
                
                updateCodeBlocks();
                draggedElement = null;
            }
        }
        
        function updateCodeBlocks() {
            const canvas = document.getElementById('code-canvas');
            codeBlocks = Array.from(canvas.querySelectorAll('.drag-block')).map(block => {
                return {
                    type: block.dataset.blockType,
                    text: block.textContent.trim()
                };
            });
        }
        
        // Code Execution
        document.getElementById('run-code').addEventListener('click', executeCode);
        document.getElementById('clear-code').addEventListener('click', clearCode);
        document.getElementById('reset-stage').addEventListener('click', resetStage);
        
        function executeCode() {
            if (codeBlocks.length === 0) {
                showSparkleMessage("‚ú® You need to add some spell blocks first! Try dragging a movement spell to the canvas.");
                return;
            }
            
            const wizard = document.getElementById('wizard');
            let currentX = 16; // Starting position (left-4 = 16px)
            let currentY = 16; // Starting position (bottom-4 = 16px)
            let delay = 0;
            
            codeBlocks.forEach((block, index) => {
                setTimeout(() => {
                    executeBlock(block, wizard, currentX, currentY);
                    
                    // Update position for movement blocks
                    if (block.type === 'move') {
                        if (block.text.includes('Right')) currentX += 40;
                        if (block.text.includes('Left')) currentX -= 40;
                        if (block.text.includes('Up')) currentY -= 40;
                        if (block.text.includes('Down')) currentY += 40;
                        
                        // Keep wizard within bounds
                        currentX = Math.max(16, Math.min(currentX, 400));
                        currentY = Math.max(16, Math.min(currentY, 200));
                        
                        wizard.style.left = currentX + 'px';
                        wizard.style.bottom = currentY + 'px';
                    }
                    
                    // Award points
                    awardMagicPoints(10);
                    
                    // Check for lesson completion
                    if (index === codeBlocks.length - 1) {
                        setTimeout(() => {
                            checkLessonCompletion();
                        }, 500);
                    }
                }, delay);
                
                delay += 1000; // 1 second between each block execution
            });
        }
        
        function executeBlock(block, wizard, x, y) {
            const magicEffects = document.getElementById('magic-effects');
            
            switch (block.type) {
                case 'action':
                    createMagicEffect(block.text, x, y);
                    break;
                case 'control':
                    if (block.text.includes('Wait')) {
                        // Wait is handled by the delay system
                    }
                    break;
            }
        }
        
        function createMagicEffect(effectType, x, y) {
            const magicEffects = document.getElementById('magic-effects');
            const effect = document.createElement('div');
            effect.className = 'absolute text-2xl pointer-events-none';
            effect.style.left = (x + 20) + 'px';
            effect.style.bottom = (y + 20) + 'px';
            
            if (effectType.includes('Sparkle')) {
                effect.innerHTML = '‚ú®';
                effect.className += ' sparkle';
            } else if (effectType.includes('Orb')) {
                effect.innerHTML = 'üîÆ';
                effect.className += ' float';
            } else if (effectType.includes('Star')) {
                effect.innerHTML = 'üåü';
                effect.className += ' sparkle';
            }
            
            magicEffects.appendChild(effect);
            
            // Remove effect after animation
            setTimeout(() => {
                effect.remove();
            }, 2000);
        }
        
        function clearCode() {
            const canvas = document.getElementById('code-canvas');
            canvas.innerHTML = `
                <div class="text-center text-purple-400 py-8">
                    <span class="text-4xl block mb-2">üéØ</span>
                    <p class="text-lg">Drag spell blocks here to create your magic!</p>
                    <p class="text-sm mt-2">Start with a movement spell to make the wizard move</p>
                </div>
            `;
            codeBlocks = [];
        }
        
        function resetStage() {
            const wizard = document.getElementById('wizard');
            const magicEffects = document.getElementById('magic-effects');
            
            wizard.style.left = '16px';
            wizard.style.bottom = '16px';
            magicEffects.innerHTML = '';
        }
        
        function awardMagicPoints(points) {
            const magicPointsEl = document.getElementById('magic-points');
            const currentPoints = parseInt(magicPointsEl.textContent);
            magicPointsEl.textContent = currentPoints + points;
        }
        
        function checkLessonCompletion() {
            if (codeBlocks.length >= 3) {
                showSparkleMessage("üéâ Fantastic! You've completed your first magical spell! You're ready for the next lesson!");
                awardMagicPoints(50);
                
                // Update achievements
                const achievementsEl = document.getElementById('achievements');
                achievementsEl.textContent = parseInt(achievementsEl.textContent) + 1;
                
                // Unlock next lesson (visual feedback)
                setTimeout(() => {
                    const nextLesson = document.querySelector('[data-lesson="2"]');
                    if (nextLesson) {
                        nextLesson.classList.remove('bg-gray-100', 'text-gray-600');
                        nextLesson.classList.add('bg-gradient-to-r', 'from-purple-400', 'to-pink-400', 'text-white');
                    }
                }, 1000);
            }
        }
        
        // Professor Sparkle Integration
        function initializeProfessorSparkle() {
            const sparkleBtn = document.getElementById('sparkle-btn');
            const sparkleModal = document.getElementById('sparkle-modal');
            const closeSparkle = document.getElementById('close-sparkle');
            const sendSparkle = document.getElementById('send-sparkle');
            const sparkleInput = document.getElementById('sparkle-input');
            const voiceSparkle = document.getElementById('voice-sparkle');
            
            sparkleBtn.addEventListener('click', () => {
                sparkleModal.classList.remove('hidden');
            });
            
            closeSparkle.addEventListener('click', () => {
                sparkleModal.classList.add('hidden');
            });
            
            sendSparkle.addEventListener('click', sendMessageToSparkle);
            sparkleInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessageToSparkle();
                }
            });
            
            voiceSparkle.addEventListener('click', startVoiceChat);
        }
        
        function sendMessageToSparkle() {
            const input = document.getElementById('sparkle-input');
            const message = input.value.trim();
            
            if (message) {
                addChatMessage(message, 'user');
                input.value = '';
                
                // Simulate Professor Sparkle response
                setTimeout(() => {
                    const response = generateSparkleResponse(message);
                    addChatMessage(response, 'sparkle');
                }, 1000);
            }
        }
        
        function addChatMessage(message, sender) {
            const chat = document.getElementById('sparkle-chat');
            const messageDiv = document.createElement('div');
            messageDiv.className = `sparkle-message ${sender === 'user' ? 'bg-purple-100 ml-8' : 'bg-white mr-8'} rounded-lg p-3 mb-3`;
            
            if (sender === 'user') {
                messageDiv.innerHTML = `<p class="text-purple-800">${message}</p>`;
            } else {
                messageDiv.innerHTML = `<p class="text-purple-700">‚ú® ${message}</p>`;
            }
            
            chat.appendChild(messageDiv);
            chat.scrollTop = chat.scrollHeight;
        }
        
        function generateSparkleResponse(message) {
            const responses = [
                "That's a wonderful question! In the Magic Workshop, we use visual blocks to create spells. Try dragging a movement block to make the wizard move!",
                "Great thinking! Remember, coding is like casting spells - you need to put the right blocks in the right order to make magic happen!",
                "I love your curiosity! Each block represents a different type of magic. Movement blocks make things move, action blocks create effects, and control blocks help you repeat spells!",
                "Excellent! You're learning the fundamental concepts of programming through magic. Keep experimenting with different combinations of blocks!",
                "That's the spirit of a true wizard! Don't be afraid to try different combinations - that's how we discover new magical possibilities!"
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }
        
        function startVoiceChat() {
            // Placeholder for voice integration
            showSparkleMessage("üé§ Voice chat with Professor Sparkle is coming soon! For now, you can type your questions and I'll help you learn magic coding!");
        }
        
        function showSparkleMessage(message) {
            const sparkleModal = document.getElementById('sparkle-modal');
            sparkleModal.classList.remove('hidden');
            addChatMessage(message, 'sparkle');
        }
        
        function initializeMagicStage() {
            // Add some initial sparkle effects
            setTimeout(() => {
                createRandomSparkles();
            }, 2000);
        }
        
        function createRandomSparkles() {
            const stage = document.getElementById('magic-stage');
            const sparkle = document.createElement('div');
            sparkle.className = 'absolute text-yellow-300 text-sm sparkle';
            sparkle.innerHTML = '‚ú®';
            sparkle.style.left = Math.random() * 300 + 'px';
            sparkle.style.top = Math.random() * 200 + 'px';
            
            stage.appendChild(sparkle);
            
            setTimeout(() => {
                sparkle.remove();
            }, 2000);
            
            // Create more sparkles randomly
            setTimeout(createRandomSparkles, Math.random() * 5000 + 3000);
        }
    </script>
</body>
</html>
