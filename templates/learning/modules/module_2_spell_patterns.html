<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 2: Casting Spell Patterns - Magic Workshop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1) rotate(180deg); }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .sparkle { animation: sparkle 2s linear infinite; }
        .float { animation: float 3s ease-in-out infinite; }
        .drag-block {
            cursor: grab;
            transition: all 0.3s ease;
        }
        .drag-block:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .pattern-highlight {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-100 via-pink-50 to-blue-100 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-lg border-b-4 border-purple-300">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="/learning/magic-workshop" class="flex items-center text-purple-600 hover:text-purple-800 transition-colors">
                        <span class="text-xl">‚Üê</span>
                        <span class="ml-2 font-semibold">Back to Magic Workshop</span>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-purple-700 font-bold">Module 2: Casting Spell Patterns</div>
                    <button id="sparkle-btn" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-full font-semibold transition-all duration-300 transform hover:scale-105">
                        ‚ú® Ask Professor Sparkle
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            
            <!-- Module Content -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl shadow-xl p-6 border-4 border-purple-200">
                    <div class="flex items-center mb-4">
                        <span class="text-3xl mr-3">üîÆ</span>
                        <h2 class="text-2xl font-bold text-purple-800">Lesson Objective</h2>
                    </div>
                    <div class="space-y-4">
                        <p class="text-gray-700">Learn to create magical spell patterns by combining multiple spell blocks in sequence!</p>
                        
                        <div class="bg-purple-50 p-4 rounded-xl">
                            <h3 class="font-bold text-purple-700 mb-2">üéØ Goals:</h3>
                            <ul class="text-sm text-purple-600 space-y-1">
                                <li>‚Ä¢ Combine 3+ spell blocks</li>
                                <li>‚Ä¢ Create movement patterns</li>
                                <li>‚Ä¢ Use action spells in sequence</li>
                                <li>‚Ä¢ Make the wizard dance!</li>
                            </ul>
                        </div>

                        <div class="bg-yellow-50 p-4 rounded-xl">
                            <h3 class="font-bold text-yellow-700 mb-2">üí° Pattern Examples:</h3>
                            <div class="text-sm text-yellow-600 space-y-2">
                                <div class="pattern-highlight p-2 rounded text-white font-semibold">
                                    Move Right ‚Üí Cast Sparkle ‚Üí Move Left
                                </div>
                                <div class="pattern-highlight p-2 rounded text-white font-semibold">
                                    Move Up ‚Üí Magic Orb ‚Üí Move Down
                                </div>
                            </div>
                        </div>

                        <div class="bg-green-50 p-4 rounded-xl">
                            <h3 class="font-bold text-green-700 mb-2">üèÜ Success Criteria:</h3>
                            <ul class="text-sm text-green-600 space-y-1">
                                <li>‚Ä¢ Use at least 3 spell blocks</li>
                                <li>‚Ä¢ Include both movement and action spells</li>
                                <li>‚Ä¢ Create a repeating pattern</li>
                                <li>‚Ä¢ Watch the wizard perform your pattern!</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Spell Blocks -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl shadow-xl p-6 border-4 border-blue-200">
                    <div class="flex items-center mb-4">
                        <span class="text-3xl mr-3">ü™Ñ</span>
                        <h2 class="text-2xl font-bold text-blue-800">Pattern Spell Blocks</h2>
                    </div>
                    
                    <div class="space-y-3">
                        <h3 class="font-bold text-blue-700">Movement Spells</h3>
                        <div class="space-y-2">
                            <div class="drag-block bg-blue-500 text-white p-3 rounded-lg text-center font-semibold" draggable="true" data-spell="move_right">
                                ‚û°Ô∏è Move Right
                            </div>
                            <div class="drag-block bg-blue-500 text-white p-3 rounded-lg text-center font-semibold" draggable="true" data-spell="move_left">
                                ‚¨ÖÔ∏è Move Left
                            </div>
                            <div class="drag-block bg-blue-500 text-white p-3 rounded-lg text-center font-semibold" draggable="true" data-spell="move_up">
                                ‚¨ÜÔ∏è Move Up
                            </div>
                            <div class="drag-block bg-blue-500 text-white p-3 rounded-lg text-center font-semibold" draggable="true" data-spell="move_down">
                                ‚¨áÔ∏è Move Down
                            </div>
                        </div>

                        <h3 class="font-bold text-green-700 mt-4">Action Spells</h3>
                        <div class="space-y-2">
                            <div class="drag-block bg-green-500 text-white p-3 rounded-lg text-center font-semibold" draggable="true" data-spell="cast_sparkle">
                                ‚ú® Cast Sparkle
                            </div>
                            <div class="drag-block bg-green-500 text-white p-3 rounded-lg text-center font-semibold" draggable="true" data-spell="magic_orb">
                                üîÆ Magic Orb
                            </div>
                            <div class="drag-block bg-green-500 text-white p-3 rounded-lg text-center font-semibold" draggable="true" data-spell="star_burst">
                                üåü Star Burst
                            </div>
                        </div>

                        <h3 class="font-bold text-orange-700 mt-4">Pattern Spells</h3>
                        <div class="space-y-2">
                            <div class="drag-block bg-orange-500 text-white p-3 rounded-lg text-center font-semibold" draggable="true" data-spell="repeat_3">
                                üîÑ Repeat 3 times
                            </div>
                            <div class="drag-block bg-orange-500 text-white p-3 rounded-lg text-center font-semibold" draggable="true" data-spell="wait_1">
                                ‚è±Ô∏è Wait 1 second
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Spell Canvas -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl shadow-xl p-6 border-4 border-green-200">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <span class="text-3xl mr-3">üßô‚Äç‚ôÇÔ∏è</span>
                            <h2 class="text-2xl font-bold text-green-800">Pattern Canvas</h2>
                        </div>
                        <div class="flex space-x-2">
                            <button id="cast-spell" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                                ‚ñ∂Ô∏è Cast Pattern
                            </button>
                            <button id="clear-canvas" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                                üóëÔ∏è Clear
                            </button>
                        </div>
                    </div>
                    
                    <div id="spell-canvas" class="min-h-96 border-2 border-dashed border-gray-300 rounded-xl p-4 bg-gradient-to-br from-gray-50 to-gray-100">
                        <div class="text-center text-gray-500 mt-20">
                            <div class="text-6xl mb-4">üéØ</div>
                            <p class="text-lg font-semibold">Drag spell blocks here to create your magical pattern!</p>
                            <p class="text-sm mt-2">Try: Move Right ‚Üí Cast Sparkle ‚Üí Move Left ‚Üí Repeat 3 times</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Magic Stage -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl shadow-xl p-6 border-4 border-yellow-200">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <span class="text-3xl mr-3">üé≠</span>
                            <h2 class="text-2xl font-bold text-yellow-800">Magic Stage</h2>
                        </div>
                        <button id="reset-wizard" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                            üîÑ Reset
                        </button>
                    </div>
                    
                    <div id="magic-stage" class="h-96 bg-gradient-to-br from-purple-200 via-pink-200 to-blue-200 rounded-xl relative overflow-hidden border-4 border-yellow-300">
                        <div id="wizard" class="absolute text-6xl transition-all duration-1000 ease-in-out float" style="left: 50%; top: 50%; transform: translate(-50%, -50%);">
                            üßô‚Äç‚ôÇÔ∏è
                        </div>
                        <div id="magic-effects" class="absolute inset-0 pointer-events-none"></div>
                    </div>

                    <div class="mt-4 flex justify-between items-center">
                        <div class="text-yellow-700">
                            <span class="font-semibold">‚≠ê Pattern Points: </span>
                            <span id="pattern-points" class="font-bold text-2xl">0</span>
                        </div>
                        <div class="text-yellow-700">
                            <span class="font-semibold">üèÜ Patterns Created: </span>
                            <span id="patterns-created" class="font-bold text-2xl">0</span>
                        </div>
                    </div>

                    <div class="mt-4 p-3 bg-yellow-50 rounded-xl">
                        <p class="text-yellow-700 text-center font-semibold">
                            Create amazing spell patterns and watch the wizard perform them!
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Professor Sparkle Modal -->
    <div id="sparkle-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 border-4 border-purple-300">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center mr-3">
                            <span class="text-white text-xl">‚ú®</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-purple-800">Professor Sparkle</h3>
                            <p class="text-purple-600 text-sm">Your Magical Coding Tutor</p>
                        </div>
                    </div>
                    <button id="close-sparkle" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                </div>
                
                <div id="sparkle-response" class="mb-4 p-4 bg-purple-50 rounded-xl">
                    <p class="text-purple-700">‚ú® Hello there, young wizard! I'm Professor Sparkle, and I'm here to help you learn the magical art of spell patterns! What would you like to know about creating amazing spell sequences?</p>
                </div>
                
                <div class="flex space-x-2">
                    <input type="text" id="sparkle-input" placeholder="Ask Professor Sparkle anything..." class="flex-1 px-4 py-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <button id="send-sparkle" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                        Send ‚ú®
                    </button>
                </div>
                
                <div class="mt-4 flex justify-center">
                    <button id="voice-sparkle" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-6 py-2 rounded-full font-semibold transition-all duration-300 transform hover:scale-105">
                        üé§ Talk to Professor Sparkle
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/sparkle_integration.js"></script>
    <script>
        // Module 2 specific functionality
        let patternPoints = 0;
        let patternsCreated = 0;
        let currentPattern = [];

        // Drag and drop functionality
        document.addEventListener('DOMContentLoaded', function() {
            const dragBlocks = document.querySelectorAll('.drag-block');
            const canvas = document.getElementById('spell-canvas');
            const wizard = document.getElementById('wizard');
            const magicEffects = document.getElementById('magic-effects');

            // Initialize drag and drop
            dragBlocks.forEach(block => {
                block.addEventListener('dragstart', handleDragStart);
            });

            canvas.addEventListener('dragover', handleDragOver);
            canvas.addEventListener('drop', handleDrop);

            function handleDragStart(e) {
                e.dataTransfer.setData('text/plain', e.target.dataset.spell);
                e.target.classList.add('dragging');
            }

            function handleDragOver(e) {
                e.preventDefault();
                canvas.classList.add('border-purple-400', 'bg-purple-50');
            }

            function handleDrop(e) {
                e.preventDefault();
                canvas.classList.remove('border-purple-400', 'bg-purple-50');
                
                const spellType = e.dataTransfer.getData('text/plain');
                const spellName = e.target.textContent || getSpellName(spellType);
                
                addSpellToCanvas(spellType, spellName);
                
                // Remove dragging class from all blocks
                dragBlocks.forEach(block => block.classList.remove('dragging'));
            }

            function getSpellName(spellType) {
                const spellNames = {
                    'move_right': '‚û°Ô∏è Move Right',
                    'move_left': '‚¨ÖÔ∏è Move Left',
                    'move_up': '‚¨ÜÔ∏è Move Up',
                    'move_down': '‚¨áÔ∏è Move Down',
                    'cast_sparkle': '‚ú® Cast Sparkle',
                    'magic_orb': 'üîÆ Magic Orb',
                    'star_burst': 'üåü Star Burst',
                    'repeat_3': 'üîÑ Repeat 3 times',
                    'wait_1': '‚è±Ô∏è Wait 1 second'
                };
                return spellNames[spellType] || spellType;
            }

            function addSpellToCanvas(spellType, spellName) {
                if (canvas.querySelector('.text-gray-500')) {
                    canvas.innerHTML = '';
                }

                const spellBlock = document.createElement('div');
                spellBlock.className = 'bg-white border-2 border-purple-300 rounded-lg p-3 mb-2 flex items-center justify-between shadow-md';
                spellBlock.innerHTML = `
                    <span class="font-semibold">${spellName}</span>
                    <button onclick="removeSpell(this)" class="text-red-500 hover:text-red-700 font-bold">√ó</button>
                `;
                
                canvas.appendChild(spellBlock);
                currentPattern.push(spellType);
                
                // Update points for adding spells
                updatePoints(10);
            }

            // Cast spell functionality
            document.getElementById('cast-spell').addEventListener('click', function() {
                if (currentPattern.length === 0) {
                    alert('Add some spell blocks to your pattern first!');
                    return;
                }

                if (currentPattern.length >= 3) {
                    castPattern();
                    updatePoints(50);
                    patternsCreated++;
                    updatePatternsCreated();
                } else {
                    alert('Create a pattern with at least 3 spell blocks!');
                }
            });

            // Clear canvas
            document.getElementById('clear-canvas').addEventListener('click', function() {
                canvas.innerHTML = `
                    <div class="text-center text-gray-500 mt-20">
                        <div class="text-6xl mb-4">üéØ</div>
                        <p class="text-lg font-semibold">Drag spell blocks here to create your magical pattern!</p>
                        <p class="text-sm mt-2">Try: Move Right ‚Üí Cast Sparkle ‚Üí Move Left ‚Üí Repeat 3 times</p>
                    </div>
                `;
                currentPattern = [];
            });

            // Reset wizard
            document.getElementById('reset-wizard').addEventListener('click', function() {
                wizard.style.left = '50%';
                wizard.style.top = '50%';
                wizard.style.transform = 'translate(-50%, -50%)';
                magicEffects.innerHTML = '';
            });

            function castPattern() {
                let delay = 0;
                const stepDelay = 1000;

                currentPattern.forEach((spell, index) => {
                    setTimeout(() => {
                        executeSpell(spell);
                    }, delay);
                    delay += stepDelay;
                });
            }

            function executeSpell(spell) {
                const wizardRect = wizard.getBoundingClientRect();
                const stageRect = document.getElementById('magic-stage').getBoundingClientRect();
                
                switch(spell) {
                    case 'move_right':
                        moveWizard(20, 0);
                        break;
                    case 'move_left':
                        moveWizard(-20, 0);
                        break;
                    case 'move_up':
                        moveWizard(0, -20);
                        break;
                    case 'move_down':
                        moveWizard(0, 20);
                        break;
                    case 'cast_sparkle':
                        createMagicEffect('‚ú®', '#fbbf24');
                        break;
                    case 'magic_orb':
                        createMagicEffect('üîÆ', '#8b5cf6');
                        break;
                    case 'star_burst':
                        createMagicEffect('üåü', '#f59e0b');
                        break;
                }
            }

            function moveWizard(deltaX, deltaY) {
                const currentLeft = parseInt(wizard.style.left) || 50;
                const currentTop = parseInt(wizard.style.top) || 50;
                
                const newLeft = Math.max(10, Math.min(90, currentLeft + deltaX));
                const newTop = Math.max(10, Math.min(90, currentTop + deltaY));
                
                wizard.style.left = newLeft + '%';
                wizard.style.top = newTop + '%';
            }

            function createMagicEffect(emoji, color) {
                const effect = document.createElement('div');
                effect.className = 'absolute text-4xl sparkle';
                effect.textContent = emoji;
                effect.style.left = wizard.style.left;
                effect.style.top = wizard.style.top;
                effect.style.color = color;
                
                magicEffects.appendChild(effect);
                
                setTimeout(() => {
                    effect.remove();
                }, 2000);
            }

            function updatePoints(points) {
                patternPoints += points;
                document.getElementById('pattern-points').textContent = patternPoints;
            }

            function updatePatternsCreated() {
                document.getElementById('patterns-created').textContent = patternsCreated;
            }
        });

        // Remove spell function
        function removeSpell(button) {
            const spellBlock = button.parentElement;
            const index = Array.from(spellBlock.parentElement.children).indexOf(spellBlock);
            currentPattern.splice(index, 1);
            spellBlock.remove();
        }

        // Professor Sparkle integration
        document.getElementById('sparkle-btn').addEventListener('click', function() {
            document.getElementById('sparkle-modal').classList.remove('hidden');
        });

        document.getElementById('close-sparkle').addEventListener('click', function() {
            document.getElementById('sparkle-modal').classList.add('hidden');
        });
    </script>
</body>
</html>

